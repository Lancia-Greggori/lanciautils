#!/bin/bash -eu
. /usr/subr/Xout
I="$(dmenu -p "$PROGN:" < /dev/null)" || exit $?
O="$(hunspell <<< "$I" | sed -r '/^$|^Hunspell [0-9.]+/d')"
if [[ "$O" =~ ^# ]]; then
	perr "Word \"$I\" not found in dictionary"
	exit 1
elif [[ "$O" =~ ^\*$ ]]; then
	pmsg 'Word correct'
	echo "$I" | tr -d '\n' | xclip -selection clipboard
elif [[ "$O" =~ \+\ [[:alnum:]]+ ]]; then
	O="${O#+ }"
	printf '%s\n%s' "$O" "$I" | dmenu -p "\"$I\": plural form of \"$O\"" \
	       	| tr -d '\n' | xclip -selection clipboard
else
	cut -d':' -f2 <<< "$O" | tr -d ' ' | tr ',' '\n' | \
		dmenu | tr -d '\n' | xclip -selection clipboard
fi
