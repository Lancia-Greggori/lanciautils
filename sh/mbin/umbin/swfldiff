#!/bin/sh -eu
[ "$#" -eq 0 ] && exit 1
VERB=0
[ "$1" = -v ] && {
	VERB=1
	shift 1
}
. /usr/subr/out
for file in "$@"; do
	if ! LINE="$(grep "^$(readlink -f "$file"):" /letc/swfl)"; then
		[ "$VERB" -eq 1 ] && pwrn "$file nfound in /letc/swfl"
		continue
	fi
	TRGT="$(echo "$LINE" | cut -d: -f2)"
	[ ! -e "$TRGT" ] && continue
	SRC="${LINE%%:*}"
	[ "$VERB" -eq 1 ] && printf "@$SRC\t$TRGT\n"
	if ! O="$(diff "$SRC" "$TRGT")"; then
		[ "$VERB" -ne 1 ] && printf "@$SRC\t$TRGT\n"
		echo "$O"
	fi
done
